<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ã‚³ãƒãƒ³ãƒ‰ç‹å›½ - RPGé¢¨ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°å­¦ç¿’ãƒ„ãƒ¼ãƒ«</title>
  <style>
    /* Base Reset */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    /* Pixel Font */
    @import url('https://fonts.googleapis.com/css2?family=DotGothic16&display=swap');

    :root {
      --bg-dark: #1a1a2e;
      --bg-panel: #16213e;
      --border-light: #e8d4b8;
      --border-dark: #8b7355;
      --text-white: #ffffff;
      --text-gold: #ffd700;
      --text-cyan: #00ffff;
      --text-green: #00ff00;
      --text-red: #ff6b6b;
      --hp-green: #22c55e;
      --mp-blue: #3b82f6;
      --exp-yellow: #eab308;
    }

    body {
      font-family: 'DotGothic16', monospace;
      background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
      min-height: 100vh;
      color: var(--text-white);
      overflow: hidden;
    }

    /* RPG Window Frame */
    .rpg-window {
      background: linear-gradient(180deg, #2a2a5a 0%, #1a1a3a 100%);
      border: 4px solid var(--border-light);
      border-radius: 8px;
      box-shadow:
        inset 0 0 0 2px var(--border-dark),
        0 8px 32px rgba(0,0,0,0.5);
      position: relative;
    }

    .rpg-window::before {
      content: '';
      position: absolute;
      top: 4px; left: 4px; right: 4px; bottom: 4px;
      border: 2px solid rgba(255,255,255,0.1);
      border-radius: 4px;
      pointer-events: none;
    }

    /* Game Container */
    .game-container {
      width: 100vw;
      height: 100vh;
      display: grid;
      grid-template-columns: 280px 1fr 240px;
      grid-template-rows: auto 1fr auto;
      gap: 12px;
      padding: 16px;
    }

    /* Header */
    .game-header {
      grid-column: 1 / -1;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 20px;
    }

    .game-title {
      font-size: 24px;
      color: var(--text-gold);
      text-shadow: 2px 2px 0 #8b6914, 0 0 20px rgba(255,215,0,0.3);
      letter-spacing: 4px;
    }

    .mode-toggle {
      display: flex;
      gap: 8px;
    }

    .mode-btn {
      padding: 8px 16px;
      background: rgba(255,255,255,0.1);
      border: 2px solid var(--border-light);
      border-radius: 4px;
      color: var(--text-white);
      font-family: inherit;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .mode-btn.active {
      background: linear-gradient(180deg, #4a4a8a 0%, #3a3a6a 100%);
      color: var(--text-gold);
    }

    .mode-btn:hover {
      background: rgba(255,255,255,0.2);
    }

    /* Status Panel */
    .status-panel {
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .character-info {
      text-align: center;
      padding-bottom: 16px;
      border-bottom: 2px dashed rgba(255,255,255,0.2);
    }

    .character-sprite {
      width: 64px;
      height: 64px;
      margin: 0 auto 8px;
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      animation: bounce 1s ease-in-out infinite;
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-4px); }
    }

    .character-name {
      font-size: 18px;
      color: var(--text-gold);
      margin-bottom: 4px;
    }

    .character-title {
      font-size: 12px;
      color: var(--text-cyan);
    }

    .stat-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 14px;
    }

    .stat-label {
      color: rgba(255,255,255,0.7);
    }

    .stat-value {
      color: var(--text-gold);
    }

    .bar-container {
      margin-top: 4px;
    }

    .bar-label {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      margin-bottom: 4px;
    }

    .bar {
      height: 12px;
      background: rgba(0,0,0,0.5);
      border-radius: 6px;
      overflow: hidden;
      border: 1px solid rgba(255,255,255,0.2);
    }

    .bar-fill {
      height: 100%;
      transition: width 0.5s ease;
    }

    .bar-hp .bar-fill { background: linear-gradient(90deg, #16a34a 0%, #22c55e 100%); }
    .bar-mp .bar-fill { background: linear-gradient(90deg, #2563eb 0%, #3b82f6 100%); }
    .bar-exp .bar-fill { background: linear-gradient(90deg, #ca8a04 0%, #eab308 100%); }

    .commands-learned {
      margin-top: auto;
    }

    .commands-learned h3 {
      font-size: 14px;
      color: var(--text-cyan);
      margin-bottom: 8px;
    }

    .command-list {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .command-tag {
      padding: 4px 8px;
      background: rgba(0,255,255,0.1);
      border: 1px solid var(--text-cyan);
      border-radius: 4px;
      font-size: 12px;
      color: var(--text-cyan);
    }

    .command-tag.locked {
      opacity: 0.3;
      border-style: dashed;
    }

    /* Main Game Area */
    .main-area {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .scene-window {
      flex: 1;
      padding: 20px;
      display: flex;
      flex-direction: column;
    }

    .scene-title {
      font-size: 20px;
      color: var(--text-gold);
      margin-bottom: 16px;
      text-align: center;
    }

    .scene-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: 20px;
    }

    .scene-art {
      font-size: 48px;
      text-align: center;
      line-height: 1.2;
    }

    .file-system-view {
      width: 100%;
      max-width: 500px;
      background: rgba(0,0,0,0.3);
      border-radius: 8px;
      padding: 16px;
    }

    .current-path {
      font-size: 14px;
      color: var(--text-cyan);
      margin-bottom: 12px;
      padding: 8px;
      background: rgba(0,255,255,0.1);
      border-radius: 4px;
    }

    .file-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      gap: 12px;
    }

    .file-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      padding: 12px 8px;
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .file-item:hover {
      background: rgba(255,255,255,0.1);
      transform: translateY(-2px);
    }

    .file-item.selected {
      background: rgba(255,215,0,0.2);
      border: 2px solid var(--text-gold);
    }

    .file-icon {
      font-size: 32px;
    }

    .file-name {
      font-size: 11px;
      text-align: center;
      word-break: break-all;
      color: var(--text-white);
    }

    .file-item.directory .file-name {
      color: var(--text-cyan);
    }

    /* Terminal Window */
    .terminal-window {
      padding: 16px;
    }

    .terminal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .terminal-title {
      color: var(--text-green);
      font-size: 14px;
    }

    .terminal-output {
      background: rgba(0,0,0,0.5);
      border-radius: 4px;
      padding: 12px;
      height: 120px;
      overflow-y: auto;
      font-size: 13px;
      line-height: 1.6;
      margin-bottom: 12px;
    }

    .output-line {
      margin-bottom: 4px;
    }

    .output-line.command {
      color: var(--text-green);
    }

    .output-line.result {
      color: var(--text-white);
    }

    .output-line.error {
      color: var(--text-red);
    }

    .output-line.success {
      color: var(--text-gold);
    }

    .terminal-input-container {
      display: flex;
      gap: 8px;
    }

    .terminal-prompt {
      color: var(--text-green);
      font-size: 14px;
    }

    .terminal-input {
      flex: 1;
      background: transparent;
      border: none;
      color: var(--text-green);
      font-family: inherit;
      font-size: 14px;
      outline: none;
    }

    /* Quest Panel */
    .quest-panel {
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .quest-title {
      font-size: 16px;
      color: var(--text-gold);
      text-align: center;
      padding-bottom: 12px;
      border-bottom: 2px dashed rgba(255,255,255,0.2);
    }

    .quest-item {
      padding: 12px;
      background: rgba(0,0,0,0.2);
      border-radius: 8px;
      border-left: 4px solid var(--text-cyan);
    }

    .quest-item.completed {
      border-left-color: var(--hp-green);
      opacity: 0.7;
    }

    .quest-item.active {
      border-left-color: var(--text-gold);
      background: rgba(255,215,0,0.1);
    }

    .quest-name {
      font-size: 14px;
      margin-bottom: 4px;
    }

    .quest-desc {
      font-size: 11px;
      color: rgba(255,255,255,0.6);
    }

    .quest-reward {
      font-size: 11px;
      color: var(--text-gold);
      margin-top: 8px;
    }

    /* Message Box */
    .message-box {
      grid-column: 1 / -1;
      padding: 20px 24px;
      min-height: 100px;
    }

    .message-content {
      display: flex;
      align-items: flex-start;
      gap: 16px;
    }

    .speaker-icon {
      width: 48px;
      height: 48px;
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      flex-shrink: 0;
    }

    .message-text {
      flex: 1;
    }

    .speaker-name {
      font-size: 14px;
      color: var(--text-gold);
      margin-bottom: 8px;
    }

    .message-body {
      font-size: 16px;
      line-height: 1.8;
    }

    .message-body .typing-cursor {
      animation: blink 1s infinite;
    }

    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0; }
    }

    .message-actions {
      display: flex;
      gap: 12px;
      margin-top: 12px;
    }

    .action-btn {
      padding: 8px 20px;
      background: linear-gradient(180deg, #4a4a8a 0%, #3a3a6a 100%);
      border: 2px solid var(--border-light);
      border-radius: 4px;
      color: var(--text-white);
      font-family: inherit;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .action-btn:hover {
      background: linear-gradient(180deg, #5a5a9a 0%, #4a4a7a 100%);
      transform: translateY(-2px);
    }

    .action-btn.primary {
      background: linear-gradient(180deg, #ca8a04 0%, #a16207 100%);
      color: var(--text-white);
    }

    /* Navigator Mode */
    .navigator-panel {
      display: none;
      grid-column: 1 / -1;
      padding: 16px;
      background: rgba(59, 130, 246, 0.1);
      border: 2px solid var(--mp-blue);
    }

    .navigator-panel.visible {
      display: block;
    }

    .navigator-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .navigator-title {
      color: var(--mp-blue);
      font-size: 16px;
    }

    .hint-cards {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .hint-card {
      padding: 12px 16px;
      background: rgba(59, 130, 246, 0.2);
      border-radius: 8px;
      border: 1px solid var(--mp-blue);
    }

    .hint-card h4 {
      font-size: 12px;
      color: var(--text-cyan);
      margin-bottom: 4px;
    }

    .hint-card p {
      font-size: 14px;
    }

    /* Start Screen */
    .start-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .start-screen.hidden {
      display: none;
    }

    .start-logo {
      font-size: 48px;
      margin-bottom: 20px;
      animation: float 3s ease-in-out infinite;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    .start-title {
      font-size: 36px;
      color: var(--text-gold);
      text-shadow: 2px 2px 0 #8b6914, 0 0 30px rgba(255,215,0,0.5);
      margin-bottom: 8px;
      letter-spacing: 8px;
    }

    .start-subtitle {
      font-size: 16px;
      color: var(--text-cyan);
      margin-bottom: 40px;
    }

    .start-menu {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .start-btn {
      padding: 16px 48px;
      background: linear-gradient(180deg, #4a4a8a 0%, #3a3a6a 100%);
      border: 3px solid var(--border-light);
      border-radius: 8px;
      color: var(--text-white);
      font-family: inherit;
      font-size: 18px;
      cursor: pointer;
      transition: all 0.2s;
      min-width: 280px;
    }

    .start-btn:hover {
      background: linear-gradient(180deg, #5a5a9a 0%, #4a4a7a 100%);
      transform: scale(1.05);
    }

    .start-btn.selected {
      background: linear-gradient(180deg, #ca8a04 0%, #a16207 100%);
      animation: pulse 1s infinite;
    }

    @keyframes pulse {
      0%, 100% { box-shadow: 0 0 0 0 rgba(255,215,0,0.4); }
      50% { box-shadow: 0 0 0 10px rgba(255,215,0,0); }
    }

    .start-hint {
      margin-top: 40px;
      font-size: 12px;
      color: rgba(255,255,255,0.5);
    }

    /* Level Up Animation */
    .level-up-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }

    .level-up-overlay.visible {
      opacity: 1;
      pointer-events: auto;
    }

    .level-up-content {
      text-align: center;
      animation: levelUpBounce 0.5s ease-out;
    }

    @keyframes levelUpBounce {
      0% { transform: scale(0.5); opacity: 0; }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); opacity: 1; }
    }

    .level-up-text {
      font-size: 48px;
      color: var(--text-gold);
      text-shadow: 0 0 30px rgba(255,215,0,0.8);
      margin-bottom: 20px;
    }

    .level-up-detail {
      font-size: 24px;
      color: var(--text-white);
    }

    .new-command {
      margin-top: 20px;
      padding: 16px 24px;
      background: rgba(0,255,255,0.2);
      border: 2px solid var(--text-cyan);
      border-radius: 8px;
    }

    .new-command h4 {
      font-size: 14px;
      color: var(--text-cyan);
      margin-bottom: 8px;
    }

    .new-command code {
      font-size: 24px;
      color: var(--text-gold);
    }

    /* Toast Notifications */
    .toast-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 3000;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .toast {
      padding: 12px 20px;
      background: linear-gradient(180deg, #2a2a5a 0%, #1a1a3a 100%);
      border: 2px solid var(--border-light);
      border-radius: 8px;
      animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    .toast.exp {
      border-color: var(--exp-yellow);
    }

    .toast.success {
      border-color: var(--hp-green);
    }

    .toast.error {
      border-color: var(--text-red);
    }
  </style>
</head>
<body>
  <!-- Start Screen -->
  <div class="start-screen" id="startScreen">
    <div class="start-logo">
      <span style="font-size: 64px;">ğŸ°</span>
    </div>
    <h1 class="start-title">ã‚³ãƒãƒ³ãƒ‰ç‹å›½</h1>
    <p class="start-subtitle">ã€œ RPGé¢¨ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°å­¦ç¿’ãƒ„ãƒ¼ãƒ« ã€œ</p>

    <div class="start-menu">
      <button class="start-btn selected" onclick="startGame('hero')">
        âš”ï¸ å‹‡è€…ãƒ¢ãƒ¼ãƒ‰ã§å§‹ã‚ã‚‹
      </button>
      <button class="start-btn" onclick="startGame('navigator')">
        ğŸ“– ãƒŠãƒ“ã‚²ãƒ¼ã‚¿ãƒ¼ãƒ¢ãƒ¼ãƒ‰ã§å§‹ã‚ã‚‹
      </button>
      <button class="start-btn" onclick="startGame('continue')" id="continueBtn" style="display: none;">
        ğŸ“œ ç¶šãã‹ã‚‰å§‹ã‚ã‚‹
      </button>
    </div>

    <p class="start-hint">
      â€» å‹‡è€…ãƒ¢ãƒ¼ãƒ‰: ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã—ã¦å†’é™º<br>
      â€» ãƒŠãƒ“ã‚²ãƒ¼ã‚¿ãƒ¼ãƒ¢ãƒ¼ãƒ‰: ãƒ’ãƒ³ãƒˆã‚’è¦‹ãªãŒã‚‰ã‚µãƒãƒ¼ãƒˆ
    </p>
  </div>

  <!-- Game Container -->
  <div class="game-container" id="gameContainer" style="display: none;">

    <!-- Header -->
    <header class="game-header rpg-window">
      <h1 class="game-title">ğŸ° ã‚³ãƒãƒ³ãƒ‰ç‹å›½</h1>
      <div class="mode-toggle">
        <button class="mode-btn active" id="heroModeBtn" onclick="setMode('hero')">âš”ï¸ å‹‡è€…</button>
        <button class="mode-btn" id="navModeBtn" onclick="setMode('navigator')">ğŸ“– ãƒŠãƒ“ã‚²ãƒ¼ã‚¿ãƒ¼</button>
      </div>
    </header>

    <!-- Status Panel -->
    <aside class="status-panel rpg-window">
      <div class="character-info">
        <div class="character-sprite">âš”ï¸</div>
        <div class="character-name" id="playerName">ã‚³ãƒãƒ³ãƒ€ãƒ¼</div>
        <div class="character-title" id="playerTitle">è¦‹ç¿’ã„å‹‡è€…</div>
      </div>

      <div class="stat-row">
        <span class="stat-label">ãƒ¬ãƒ™ãƒ«</span>
        <span class="stat-value" id="playerLevel">1</span>
      </div>

      <div class="bar-container">
        <div class="bar-label">
          <span>HP</span>
          <span id="hpValue">100/100</span>
        </div>
        <div class="bar bar-hp">
          <div class="bar-fill" id="hpBar" style="width: 100%"></div>
        </div>
      </div>

      <div class="bar-container">
        <div class="bar-label">
          <span>MP</span>
          <span id="mpValue">50/50</span>
        </div>
        <div class="bar bar-mp">
          <div class="bar-fill" id="mpBar" style="width: 100%"></div>
        </div>
      </div>

      <div class="bar-container">
        <div class="bar-label">
          <span>çµŒé¨“å€¤</span>
          <span id="expValue">0/100</span>
        </div>
        <div class="bar bar-exp">
          <div class="bar-fill" id="expBar" style="width: 0%"></div>
        </div>
      </div>

      <div class="commands-learned">
        <h3>ç¿’å¾—ã—ãŸå‘ªæ–‡</h3>
        <div class="command-list" id="commandList">
          <span class="command-tag">pwd</span>
          <span class="command-tag locked">ls</span>
          <span class="command-tag locked">cd</span>
          <span class="command-tag locked">cat</span>
          <span class="command-tag locked">mkdir</span>
        </div>
      </div>
    </aside>

    <!-- Main Game Area -->
    <main class="main-area">
      <section class="scene-window rpg-window">
        <h2 class="scene-title" id="sceneTitle">ç¬¬1ç« : ãƒ•ã‚¡ã‚¤ãƒ«ã®æ£®</h2>
        <div class="scene-content">
          <div class="scene-art" id="sceneArt">
            ğŸŒ²ğŸŒ²ğŸŒ²<br>
            ğŸŒ²ğŸ§™â€â™‚ï¸ğŸŒ²<br>
            ğŸŒ²ğŸŒ²ğŸŒ²
          </div>

          <div class="file-system-view" id="fileSystemView">
            <div class="current-path" id="currentPath">ğŸ“‚ /forest</div>
            <div class="file-list" id="fileList">
              <!-- Files will be rendered here -->
            </div>
          </div>
        </div>
      </section>

      <!-- Terminal -->
      <section class="terminal-window rpg-window">
        <div class="terminal-header">
          <span class="terminal-title">ğŸ–¥ï¸ ã‚³ãƒãƒ³ãƒ‰å…¥åŠ›</span>
          <span style="font-size: 12px; color: rgba(255,255,255,0.5);">å‘ªæ–‡ã‚’å”±ãˆã‚ˆ</span>
        </div>
        <div class="terminal-output" id="terminalOutput">
          <div class="output-line result">ãƒ•ã‚¡ã‚¤ãƒ«ã®æ£®ã¸ã‚ˆã†ã“ãï¼</div>
          <div class="output-line result">ã¾ãšã¯ã€Œpwdã€ã¨å…¥åŠ›ã—ã¦ã€ç¾åœ¨åœ°ã‚’ç¢ºèªã—ã‚ˆã†ã€‚</div>
        </div>
        <div class="terminal-input-container">
          <span class="terminal-prompt">$ </span>
          <input type="text" class="terminal-input" id="terminalInput" placeholder="ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›..." autocomplete="off">
        </div>
      </section>
    </main>

    <!-- Quest Panel -->
    <aside class="quest-panel rpg-window">
      <h2 class="quest-title">ğŸ“œ ã‚¯ã‚¨ã‚¹ãƒˆ</h2>
      <div id="questList">
        <div class="quest-item active" id="quest1">
          <div class="quest-name">1. ç¾åœ¨åœ°ã‚’ç¢ºèªã›ã‚ˆ</div>
          <div class="quest-desc">pwdã‚³ãƒãƒ³ãƒ‰ã§ä»Šã„ã‚‹å ´æ‰€ã‚’èª¿ã¹ã‚ˆã†</div>
          <div class="quest-reward">å ±é…¬: çµŒé¨“å€¤ +20</div>
        </div>
        <div class="quest-item" id="quest2">
          <div class="quest-name">2. æ£®ã‚’è¦‹æ¸¡ã›</div>
          <div class="quest-desc">lsã‚³ãƒãƒ³ãƒ‰ã§å‘¨ã‚Šã«ã‚ã‚‹ã‚‚ã®ã‚’è¦‹ã‚ˆã†</div>
          <div class="quest-reward">å ±é…¬: çµŒé¨“å€¤ +30</div>
        </div>
        <div class="quest-item" id="quest3">
          <div class="quest-name">3. å®ç®±ã®æ´çªŸã¸</div>
          <div class="quest-desc">cdã‚³ãƒãƒ³ãƒ‰ã§caveã«ç§»å‹•ã—ã‚ˆã†</div>
          <div class="quest-reward">å ±é…¬: çµŒé¨“å€¤ +50</div>
        </div>
      </div>
    </aside>

    <!-- Navigator Panel -->
    <div class="navigator-panel rpg-window" id="navigatorPanel">
      <div class="navigator-header">
        <span class="navigator-title">ğŸ“– ãƒŠãƒ“ã‚²ãƒ¼ã‚¿ãƒ¼ãƒ¢ãƒ¼ãƒ‰</span>
        <span style="font-size: 12px; color: rgba(255,255,255,0.5);">å‹‡è€…ã‚’ã‚µãƒãƒ¼ãƒˆã—ã‚ˆã†</span>
      </div>
      <div class="hint-cards" id="hintCards">
        <div class="hint-card">
          <h4>ä»Šã®ã‚¯ã‚¨ã‚¹ãƒˆ</h4>
          <p id="currentQuestHint">ã€Œpwdã€ã‚’å…¥åŠ›ã™ã‚‹ã¨ç¾åœ¨åœ°ãŒã‚ã‹ã‚‹ã‚ˆ</p>
        </div>
        <div class="hint-card">
          <h4>å…¥åŠ›ä¾‹</h4>
          <p id="commandExample">pwd</p>
        </div>
        <div class="hint-card">
          <h4>åŠ±ã¾ã—</h4>
          <p>ã§ãã‚‹ã‚ˆï¼ã‚†ã£ãã‚Šã‚„ã£ã¦ã¿ã‚ˆã†</p>
        </div>
      </div>
    </div>

    <!-- Message Box -->
    <section class="message-box rpg-window" id="messageBox">
      <div class="message-content">
        <div class="speaker-icon" id="speakerIcon">ğŸ§™</div>
        <div class="message-text">
          <div class="speaker-name" id="speakerName">æ£®ã®è³¢è€…</div>
          <div class="message-body" id="messageBody">
            ã‚ˆã†ã“ãã€è‹¥ãå‹‡è€…ã‚ˆã€‚<br>
            ã“ã“ã¯<span style="color: #00ffff;">ãƒ•ã‚¡ã‚¤ãƒ«ã®æ£®</span>ã€‚ã‚³ãƒãƒ³ãƒ‰ç‹å›½ã¸ã®å…¥ã‚Šå£ã˜ã‚ƒã€‚<br>
            ã¾ãšã¯ã€Œ<span style="color: #ffd700;">pwd</span>ã€ã¨ã„ã†å‘ªæ–‡ã‚’å”±ãˆã¦ã€ä»Šã„ã‚‹å ´æ‰€ã‚’ç¢ºèªã™ã‚‹ã®ã˜ã‚ƒã€‚
          </div>
        </div>
      </div>
    </section>

  </div>

  <!-- Level Up Overlay -->
  <div class="level-up-overlay" id="levelUpOverlay">
    <div class="level-up-content">
      <div class="level-up-text">âœ¨ ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ï¼âœ¨</div>
      <div class="level-up-detail" id="levelUpDetail">ãƒ¬ãƒ™ãƒ« 2 ã«ãªã£ãŸï¼</div>
      <div class="new-command" id="newCommand" style="display: none;">
        <h4>æ–°ã—ã„å‘ªæ–‡ã‚’ç¿’å¾—ï¼</h4>
        <code id="newCommandName">ls</code>
      </div>
      <button class="action-btn primary" style="margin-top: 24px;" onclick="closeLevelUp()">OK</button>
    </div>
  </div>

  <!-- Toast Container -->
  <div class="toast-container" id="toastContainer"></div>

  <script>
    // ==================== GAME STATE ====================
    const gameState = {
      mode: 'hero',
      level: 1,
      exp: 0,
      expToNext: 100,
      hp: 100,
      maxHp: 100,
      mp: 50,
      maxMp: 50,
      currentPath: '/forest',
      unlockedCommands: ['pwd'],
      completedQuests: [],
      currentQuest: 1
    };

    // ==================== VIRTUAL FILE SYSTEM ====================
    const virtualFS = {
      '/forest': {
        type: 'directory',
        children: ['cave', 'river', 'tree.txt', 'map.txt'],
        art: 'ğŸŒ²ğŸŒ²ğŸŒ²\nğŸŒ²ğŸ§™â€â™‚ï¸ğŸŒ²\nğŸŒ²ğŸŒ²ğŸŒ²'
      },
      '/forest/cave': {
        type: 'directory',
        children: ['treasure.txt', 'deeper'],
        art: 'ğŸª¨ğŸ•³ï¸ğŸª¨\nğŸ•¯ï¸  ğŸ•¯ï¸\nğŸª¨ğŸª¨ğŸª¨'
      },
      '/forest/cave/deeper': {
        type: 'directory',
        children: ['secret.txt'],
        art: 'â¬›â¬›â¬›\nâ¬›ğŸ‘ï¸â¬›\nâ¬›â¬›â¬›'
      },
      '/forest/river': {
        type: 'directory',
        children: ['fish.txt', 'boat.txt'],
        art: 'ğŸŒŠğŸŒŠğŸŒŠ\nğŸš£ğŸŸğŸŒŠ\nğŸŒŠğŸŒŠğŸŒŠ'
      },
      '/forest/tree.txt': {
        type: 'file',
        content: 'å¤§ããªæœ¨ãŒãã³ãˆç«‹ã£ã¦ã„ã‚‹ã€‚\næœ¨ã®å¹¹ã«ã¯ã€Œã‚³ãƒãƒ³ãƒ‰ã‚’å­¦ã¹ã°é“ã¯é–‹ã‘ã‚‹ã€ã¨åˆ»ã¾ã‚Œã¦ã„ã‚‹ã€‚'
      },
      '/forest/map.txt': {
        type: 'file',
        content: '=== ãƒ•ã‚¡ã‚¤ãƒ«ã®æ£® åœ°å›³ ===\n\n[æ£®ã®å…¥å£] â†’ [æ´çªŸ(cave)] â†’ [å¥¥æ·±ã(deeper)]\n           â†’ [å·(river)]\n\nãƒ’ãƒ³ãƒˆ: cdã‚³ãƒãƒ³ãƒ‰ã§ç§»å‹•ã§ãã‚‹'
      },
      '/forest/cave/treasure.txt': {
        type: 'file',
        content: 'âœ¨ å®ç®±ã‚’è¦‹ã¤ã‘ãŸï¼âœ¨\n\nä¸­ã«ã¯ã€Œlsã®å·»ç‰©ã€ãŒå…¥ã£ã¦ã„ãŸã€‚\nã“ã‚Œã§å‘¨ã‚Šã«ã‚ã‚‹ã‚‚ã®ã‚’è¦‹æ¸¡ã›ã‚‹ã‚ˆã†ã«ãªã‚‹ï¼'
      },
      '/forest/cave/deeper/secret.txt': {
        type: 'file',
        content: 'ğŸŒŸ éš ã•ã‚ŒãŸç§˜å¯† ğŸŒŸ\n\nã‚ˆããã“ã“ã¾ã§æ¥ãŸã€å‹‡è€…ã‚ˆã€‚\næ¬¡ã®ç« ã€Œãƒ†ã‚­ã‚¹ãƒˆã®å¡”ã€ã¸ã®é“ãŒé–‹ã‹ã‚ŒãŸã€‚'
      },
      '/forest/river/fish.txt': {
        type: 'file',
        content: 'ğŸŸ é­šãŒæ³³ã„ã§ã„ã‚‹ã€‚\n\né­šã€Œã‚³ãƒãƒ³ãƒ‰ã‚’è¦šãˆãŸã‚‰ã€ã‚‚ã£ã¨é ãã¾ã§è¡Œã‘ã‚‹ã‚ˆï¼ã€'
      },
      '/forest/river/boat.txt': {
        type: 'file',
        content: 'ğŸš£ å°ã•ãªãƒœãƒ¼ãƒˆãŒã‚ã‚‹ã€‚\n\nã¾ã ä½¿ã„æ–¹ãŒã‚ã‹ã‚‰ãªã„...\nï¼ˆç¬¬2ç« ã§è§£æ”¾ã•ã‚Œã‚‹ï¼‰'
      }
    };

    // ==================== QUEST DEFINITIONS ====================
    const quests = {
      1: {
        name: 'ç¾åœ¨åœ°ã‚’ç¢ºèªã›ã‚ˆ',
        description: 'pwdã‚³ãƒãƒ³ãƒ‰ã§ä»Šã„ã‚‹å ´æ‰€ã‚’èª¿ã¹ã‚ˆã†',
        command: 'pwd',
        reward: 20,
        hint: 'ã€Œpwdã€ã‚’å…¥åŠ›ã™ã‚‹ã¨ç¾åœ¨åœ°ãŒã‚ã‹ã‚‹ã‚ˆ',
        example: 'pwd',
        onComplete: () => {
          showMessage('æ£®ã®è³¢è€…', 'ç´ æ™´ã‚‰ã—ã„ï¼ç¾åœ¨åœ°ãŒã‚ã‹ã£ãŸãªã€‚\næ¬¡ã¯ã€Œlsã€ã‚’ç¿’å¾—ã—ã¦ã€å‘¨ã‚Šã‚’è¦‹æ¸¡ã™ã®ã˜ã‚ƒã€‚', 'ğŸ§™');
        }
      },
      2: {
        name: 'æ£®ã‚’è¦‹æ¸¡ã›',
        description: 'lsã‚³ãƒãƒ³ãƒ‰ã§å‘¨ã‚Šã«ã‚ã‚‹ã‚‚ã®ã‚’è¦‹ã‚ˆã†',
        command: 'ls',
        reward: 30,
        hint: 'ã€Œlsã€ã‚’å…¥åŠ›ã™ã‚‹ã¨å‘¨ã‚Šã«ã‚ã‚‹ã‚‚ã®ãŒã‚ã‹ã‚‹ã‚ˆ',
        example: 'ls',
        unlock: 'ls',
        onComplete: () => {
          unlockCommand('ls');
          showMessage('æ£®ã®è³¢è€…', 'lsã®å‘ªæ–‡ã‚’ç¿’å¾—ã—ãŸãªï¼\nå‘¨ã‚Šã«æ´çªŸ(cave)ãŒã‚ã‚‹ã‚ˆã†ã˜ã‚ƒã€‚ã€Œcd caveã€ã§ç§»å‹•ã—ã¦ã¿ã‚‹ã®ã˜ã‚ƒã€‚', 'ğŸ§™');
        }
      },
      3: {
        name: 'å®ç®±ã®æ´çªŸã¸',
        description: 'cdã‚³ãƒãƒ³ãƒ‰ã§caveã«ç§»å‹•ã—ã‚ˆã†',
        command: 'cd cave',
        reward: 50,
        hint: 'ã€Œcd caveã€ã¨å…¥åŠ›ã™ã‚‹ã¨æ´çªŸã«ç§»å‹•ã§ãã‚‹ã‚ˆ',
        example: 'cd cave',
        unlock: 'cd',
        onComplete: () => {
          unlockCommand('cd');
          showMessage('æ£®ã®è³¢è€…', 'è¦‹äº‹ã˜ã‚ƒï¼æ´çªŸã«åˆ°é”ã—ãŸã€‚\nã“ã‚Œã§åŸºæœ¬ã®å‘ªæ–‡ã‚’ã™ã¹ã¦ç¿’å¾—ã—ãŸã€‚ç¬¬1ç« ã‚¯ãƒªã‚¢ã˜ã‚ƒï¼', 'ğŸ§™');
          showToast('ç¬¬1ç« ã€Œãƒ•ã‚¡ã‚¤ãƒ«ã®æ£®ã€ã‚¯ãƒªã‚¢ï¼', 'success');
        }
      }
    };

    // ==================== GAME FUNCTIONS ====================
    function startGame(mode) {
      document.getElementById('startScreen').classList.add('hidden');
      document.getElementById('gameContainer').style.display = 'grid';

      if (mode === 'navigator') {
        setMode('navigator');
      } else {
        setMode('hero');
      }

      renderFileList();
      document.getElementById('terminalInput').focus();
    }

    function setMode(mode) {
      gameState.mode = mode;
      document.getElementById('heroModeBtn').classList.toggle('active', mode === 'hero');
      document.getElementById('navModeBtn').classList.toggle('active', mode === 'navigator');
      document.getElementById('navigatorPanel').classList.toggle('visible', mode === 'navigator');

      if (mode === 'navigator') {
        updateNavigatorHints();
      }
    }

    function updateNavigatorHints() {
      const quest = quests[gameState.currentQuest];
      if (quest) {
        document.getElementById('currentQuestHint').textContent = quest.hint;
        document.getElementById('commandExample').textContent = quest.example;
      }
    }

    function renderFileList() {
      const fsEntry = virtualFS[gameState.currentPath];
      const fileList = document.getElementById('fileList');

      if (!fsEntry || fsEntry.type !== 'directory') {
        fileList.innerHTML = '<div style="color: #ff6b6b;">ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</div>';
        return;
      }

      document.getElementById('currentPath').textContent = `ğŸ“‚ ${gameState.currentPath}`;

      // Update scene art
      if (fsEntry.art) {
        document.getElementById('sceneArt').innerHTML = fsEntry.art.replace(/\n/g, '<br>');
      }

      // Check if ls is unlocked
      if (!gameState.unlockedCommands.includes('ls')) {
        fileList.innerHTML = '<div style="color: rgba(255,255,255,0.5); font-size: 14px; text-align: center; padding: 20px;">ï¼ˆlsã‚³ãƒãƒ³ãƒ‰ã‚’ç¿’å¾—ã™ã‚‹ã¨è¦‹ãˆã‚‹ã‚ˆã†ã«ãªã‚‹ï¼‰</div>';
        return;
      }

      let html = '';

      // Add parent directory if not at root
      if (gameState.currentPath !== '/forest') {
        html += `
          <div class="file-item directory" onclick="executeCommand('cd ..')">
            <span class="file-icon">ğŸ“</span>
            <span class="file-name">..</span>
          </div>
        `;
      }

      // Add children
      fsEntry.children.forEach(child => {
        const childPath = `${gameState.currentPath}/${child}`;
        const childEntry = virtualFS[childPath];
        const isDir = childEntry && childEntry.type === 'directory';

        html += `
          <div class="file-item ${isDir ? 'directory' : ''}" onclick="executeCommand('${isDir ? 'cd ' + child : 'cat ' + child}')">
            <span class="file-icon">${isDir ? 'ğŸ“' : 'ğŸ“„'}</span>
            <span class="file-name">${child}</span>
          </div>
        `;
      });

      fileList.innerHTML = html;
    }

    function executeCommand(cmd) {
      const input = cmd.trim();
      if (!input) return;

      const output = document.getElementById('terminalOutput');
      output.innerHTML += `<div class="output-line command">$ ${input}</div>`;

      const parts = input.split(' ');
      const command = parts[0];
      const args = parts.slice(1);

      // Check if command is unlocked
      if (!gameState.unlockedCommands.includes(command) && command !== 'help') {
        output.innerHTML += `<div class="output-line error">ã¾ã ã€Œ${command}ã€ã®å‘ªæ–‡ã‚’ç¿’å¾—ã—ã¦ã„ãªã„...</div>`;
        output.scrollTop = output.scrollHeight;
        return;
      }

      let result = '';
      let isError = false;

      switch (command) {
        case 'pwd':
          result = gameState.currentPath;
          checkQuestCompletion('pwd');
          break;

        case 'ls':
          const currentDir = virtualFS[gameState.currentPath];
          if (currentDir && currentDir.type === 'directory') {
            result = currentDir.children.map(c => {
              const childPath = `${gameState.currentPath}/${c}`;
              const isDir = virtualFS[childPath] && virtualFS[childPath].type === 'directory';
              return isDir ? `<span style="color: #00ffff;">${c}/</span>` : c;
            }).join('  ');
          }
          checkQuestCompletion('ls');
          break;

        case 'cd':
          if (!args[0]) {
            result = 'ã©ã“ã«ç§»å‹•ã™ã‚‹ï¼Ÿï¼ˆä¾‹: cd caveï¼‰';
          } else if (args[0] === '..') {
            const pathParts = gameState.currentPath.split('/').filter(p => p);
            if (pathParts.length > 1) {
              pathParts.pop();
              gameState.currentPath = '/' + pathParts.join('/');
              result = `${gameState.currentPath} ã«ç§»å‹•ã—ãŸ`;
              renderFileList();
            } else {
              result = 'ã“ã‚Œä»¥ä¸Šæˆ»ã‚Œãªã„';
              isError = true;
            }
          } else {
            const newPath = `${gameState.currentPath}/${args[0]}`;
            if (virtualFS[newPath] && virtualFS[newPath].type === 'directory') {
              gameState.currentPath = newPath;
              result = `${args[0]} ã«ç§»å‹•ã—ãŸï¼`;
              renderFileList();
              checkQuestCompletion(`cd ${args[0]}`);
            } else {
              result = `${args[0]} ã¨ã„ã†å ´æ‰€ã¯è¦‹ã¤ã‹ã‚‰ãªã„...`;
              isError = true;
            }
          }
          break;

        case 'cat':
          if (!args[0]) {
            result = 'ä½•ã‚’èª­ã‚€ï¼Ÿï¼ˆä¾‹: cat tree.txtï¼‰';
          } else {
            const filePath = `${gameState.currentPath}/${args[0]}`;
            const file = virtualFS[filePath];
            if (file && file.type === 'file') {
              result = file.content.replace(/\n/g, '<br>');
              gainExp(10);
            } else {
              result = `${args[0]} ã¯èª­ã‚ãªã„...`;
              isError = true;
            }
          }
          break;

        case 'help':
          result = `
=== ä½¿ãˆã‚‹å‘ªæ–‡ä¸€è¦§ ===<br>
<span style="color: #ffd700;">pwd</span> - ç¾åœ¨åœ°ã‚’è¡¨ç¤º<br>
<span style="color: #ffd700;">ls</span> - å‘¨ã‚Šã«ã‚ã‚‹ã‚‚ã®ã‚’è¦‹ã‚‹<br>
<span style="color: #ffd700;">cd [å ´æ‰€]</span> - ç§»å‹•ã™ã‚‹<br>
<span style="color: #ffd700;">cat [ãƒ•ã‚¡ã‚¤ãƒ«]</span> - ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã‚€<br>
<span style="color: #ffd700;">help</span> - ã“ã®ãƒ˜ãƒ«ãƒ—ã‚’è¡¨ç¤º
          `;
          break;

        default:
          result = `ã€Œ${command}ã€ã¨ã„ã†å‘ªæ–‡ã¯çŸ¥ã‚‰ãªã„...`;
          isError = true;
      }

      output.innerHTML += `<div class="output-line ${isError ? 'error' : 'result'}">${result}</div>`;
      output.scrollTop = output.scrollHeight;
    }

    function checkQuestCompletion(command) {
      const quest = quests[gameState.currentQuest];
      if (!quest) return;

      if (quest.command === command || command.startsWith(quest.command.split(' ')[0])) {
        completeQuest(gameState.currentQuest);
      }
    }

    function completeQuest(questId) {
      if (gameState.completedQuests.includes(questId)) return;

      gameState.completedQuests.push(questId);
      const quest = quests[questId];

      // Update quest UI
      const questEl = document.getElementById(`quest${questId}`);
      if (questEl) {
        questEl.classList.remove('active');
        questEl.classList.add('completed');
      }

      // Give reward
      gainExp(quest.reward);
      showToast(`ã‚¯ã‚¨ã‚¹ãƒˆå®Œäº†ï¼ +${quest.reward} EXP`, 'exp');

      // Run completion callback
      if (quest.onComplete) {
        setTimeout(quest.onComplete, 500);
      }

      // Move to next quest
      gameState.currentQuest++;
      const nextQuestEl = document.getElementById(`quest${gameState.currentQuest}`);
      if (nextQuestEl) {
        nextQuestEl.classList.add('active');
      }

      updateNavigatorHints();
    }

    function gainExp(amount) {
      gameState.exp += amount;

      if (gameState.exp >= gameState.expToNext) {
        levelUp();
      }

      updateStatusBars();
    }

    function levelUp() {
      gameState.level++;
      gameState.exp = gameState.exp - gameState.expToNext;
      gameState.expToNext = Math.floor(gameState.expToNext * 1.5);
      gameState.maxHp += 10;
      gameState.hp = gameState.maxHp;
      gameState.maxMp += 5;
      gameState.mp = gameState.maxMp;

      // Show level up overlay
      const overlay = document.getElementById('levelUpOverlay');
      document.getElementById('levelUpDetail').textContent = `ãƒ¬ãƒ™ãƒ« ${gameState.level} ã«ãªã£ãŸï¼`;
      overlay.classList.add('visible');

      // Check for new command unlock
      const newCommandEl = document.getElementById('newCommand');
      if (gameState.level === 2) {
        newCommandEl.style.display = 'block';
        document.getElementById('newCommandName').textContent = 'ls';
      } else if (gameState.level === 3) {
        newCommandEl.style.display = 'block';
        document.getElementById('newCommandName').textContent = 'cd';
      } else {
        newCommandEl.style.display = 'none';
      }

      document.getElementById('playerLevel').textContent = gameState.level;
      updateTitles();
    }

    function closeLevelUp() {
      document.getElementById('levelUpOverlay').classList.remove('visible');
    }

    function unlockCommand(cmd) {
      if (!gameState.unlockedCommands.includes(cmd)) {
        gameState.unlockedCommands.push(cmd);

        // Update command list UI
        const commandList = document.getElementById('commandList');
        const tags = commandList.querySelectorAll('.command-tag');
        tags.forEach(tag => {
          if (tag.textContent === cmd) {
            tag.classList.remove('locked');
          }
        });

        showToast(`æ–°ã—ã„å‘ªæ–‡ã€Œ${cmd}ã€ã‚’ç¿’å¾—ï¼`, 'success');
        renderFileList();
      }
    }

    function updateStatusBars() {
      document.getElementById('hpValue').textContent = `${gameState.hp}/${gameState.maxHp}`;
      document.getElementById('hpBar').style.width = `${(gameState.hp / gameState.maxHp) * 100}%`;

      document.getElementById('mpValue').textContent = `${gameState.mp}/${gameState.maxMp}`;
      document.getElementById('mpBar').style.width = `${(gameState.mp / gameState.maxMp) * 100}%`;

      document.getElementById('expValue').textContent = `${gameState.exp}/${gameState.expToNext}`;
      document.getElementById('expBar').style.width = `${(gameState.exp / gameState.expToNext) * 100}%`;
    }

    function updateTitles() {
      const titles = {
        1: 'è¦‹ç¿’ã„å‹‡è€…',
        2: 'ã‚³ãƒãƒ³ãƒ‰ä½¿ã„',
        3: 'ãƒ•ã‚¡ã‚¤ãƒ«æ¢ç´¢è€…',
        4: 'ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒã‚¹ã‚¿ãƒ¼',
        5: 'ã‚³ãƒãƒ³ãƒ‰ç‹å›½ã®é¨å£«'
      };
      document.getElementById('playerTitle').textContent = titles[gameState.level] || titles[5];
    }

    function showMessage(speaker, message, icon = 'ğŸ§™') {
      document.getElementById('speakerName').textContent = speaker;
      document.getElementById('messageBody').innerHTML = message.replace(/\n/g, '<br>');
      document.getElementById('speakerIcon').textContent = icon;
    }

    function showToast(message, type = 'exp') {
      const container = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.textContent = message;
      container.appendChild(toast);

      setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.transform = 'translateX(100%)';
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    // ==================== EVENT LISTENERS ====================
    document.getElementById('terminalInput').addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        const input = e.target.value;
        executeCommand(input);
        e.target.value = '';
      }
    });

    // Check for saved game
    const savedGame = localStorage.getItem('commandKingdomSave');
    if (savedGame) {
      document.getElementById('continueBtn').style.display = 'block';
    }

    // Initialize
    updateStatusBars();
  </script>
</body>
</html>
